# Markdown转PDF工具

一个高性能的C# WPF应用程序，用于将Markdown文档转换为PDF文件。支持中文字符、图片处理、大文件优化等功能。

## ✨ 主要特性

### 🚀 高性能处理
- **并行图片处理**：支持多线程并行处理图片，充分利用CPU资源
- **智能缓存机制**：基于SHA256的图片缓存，避免重复处理
- **大文件优化**：分块处理大型文档，降低内存占用
- **流水线处理**：Markdown解析、图片处理、PDF生成同时进行
- **动态资源调整**：根据系统配置和文件大小自动调整并行度

### 📄 格式支持
- 完整的Markdown语法支持
- 表格、代码块、数学公式
- 任务列表、脚注、引用
- **多种图片格式支持**：JPEG、PNG、GIF、BMP、TIFF、**WebP**、**SVG**
- **智能图片布局**：自动检测并排显示多张图片，节约空间
- 自动图片压缩和格式优化

### 🎨 界面设计
- Apple风格的现代化界面
- 实时预览功能
- 进度条显示处理状态
- 详细的设置选项面板

### 🌏 多语言支持
- 中文字符完美支持
- Microsoft YaHei字体优化
- UTF-8编码处理

## 📦 技术架构

### 核心组件
- **ImageProcessor**: 高性能图片处理引擎
- **MarkdownService**: 流水线式Markdown解析器
- **PdfService**: 并行PDF生成服务
- **PerformanceSettings**: 动态性能配置系统

### 性能优化技术
- **并行度控制**：根据CPU核心数和任务量动态调整
- **批处理机制**：分批处理图片以优化内存使用
- **内存管理**：定期垃圾回收和内存压缩
- **缓存策略**：多层缓存减少重复计算

## 🛠️ 系统要求

- Windows 10/11
- .NET 6.0 Runtime
- 至少4GB内存（推荐8GB+）
- 多核心CPU（推荐4核心+）

## 📥 安装方式

### 方式一：直接运行
1. 下载最新Release版本
2. 解压到任意目录
3. 运行 `MarkdownToPdf.exe`

### 方式二：源码编译
```bash
git clone https://github.com/your-repo/markdowntopdf.git
cd markdowntopdf
dotnet build --configuration Release
dotnet run
```

## 🚀 使用指南

### 基本使用
1. 点击"浏览"选择Markdown文件
2. 选择PDF输出路径
3. 调整设置（可选）
4. 点击"开始转换"

### 性能设置
在"性能"选项卡中可以调整：
- **图片处理并行度**：最大并发处理的图片数量
- **PDF处理并行度**：PDF生成的并行任务数
- **批处理大小**：每批处理的图片数量
- **内存优化级别**：内存使用优化策略
- **激进缓存**：是否启用更积极的缓存策略

### 推荐设置
| 系统配置 | 图片并行度 | PDF并行度 | 批处理大小 |
|---------|-----------|----------|----------|
| 4核8GB | 8 | 4 | 20 |
| 8核16GB | 16 | 8 | 40 |
| 16核32GB+ | 32 | 16 | 80 |

## 📊 性能特性

### 处理能力
- **小文件**（<1MB）：几乎瞬时完成
- **中等文件**（1-10MB）：通常在10-30秒内完成
- **大文件**（10-100MB）：1-5分钟，视图片数量而定
- **超大文件**（>100MB）：启用分块处理，稳定转换

### 资源利用
- **CPU使用率**：可达90%+（多核心并行）
- **内存占用**：根据文件大小和设置动态调整
- **磁盘I/O**：缓存机制减少重复读写
- **并发处理**：最高支持CPU核心数×8的并发度

## 🔧 高级功能

### 图片处理优化
- **多格式支持**：WebP、SVG、JPEG、PNG等现代图片格式
- **智能并排显示**：自动检测同段落多图片，创建并排布局节约空间
- **双引擎处理**：ImageSharp处理现代格式，System.Drawing作为后备
- 自动检测是否需要处理（尺寸、格式、压缩）
- 智能质量选择（小图高质量，大图快速模式）
- 格式转换（统一输出JPEG优化文件大小）
- 缓存复用（相同图片只处理一次）

### PDF生成优化
- 分块并行处理大文档
- 内存流式处理避免内存溢出
- 中文字体嵌入和优化
- 页面布局自动调整

### 错误处理
- 图片处理失败时自动回退
- 网络图片下载重试机制
- 详细的错误日志和提示
- 优雅的异常恢复

